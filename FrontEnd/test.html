<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8">
	<title>Sophie Bluel - Architecte d'int√©rieur</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap"
		rel="stylesheet">
	<meta name="description" content="">
</head>

<body>

    <dialog id="modal">
        <div >
            <div>
                <button id="closeModal">X</button>
            </div>
            <div >
                <p>Galerie photo</p>
            </div>
            <div id="modalGallery">
            </div>
            <div></div>
            <div>
                <button>
                    <p>Ajouter une photo</p>
                </button>
            </div>
        </div>
    </dialog>
    <button id="openModal">Show the modal</button>

    <script>

        const showAllImagesModal = (images) => {
            const modalGallery = document.querySelector("#modalGallery");
            modalGallery.innerHTML = "";
            for (let i = 0; i < images.length; i++) {
                const image = images[i];
                const container = document.createElement("div");
                const imageElement = document.createElement("img");
                imageElement.src = image.imageUrl;
                imageElement.id = image.id;
                const iconElement = document.createElement("i");
                iconElement.classList.add("fa-solid", "fa-trash-can"); 
                iconElement.setAttribute("aria-hidden", "true");
                iconElement.innerHTML = "DELETE BUTTON";
                const editElement = document.createElement("p");
                editElement.innerText = "supprimer";
                container.appendChild(imageElement);
                container.appendChild(editElement);
                container.appendChild(iconElement);
                modalGallery.appendChild(container);
            }
        };

        window.addEventListener("load", async () => {

            const modal = document.querySelector("#modal");

            const worksAPICall = await fetch('http://localhost:5678/api/works');
            let images = await worksAPICall.json();

            showAllImagesModal(images);
            // modal.showModal() ;

            const openModalBtn = document.querySelector("#openModal");
            openModalBtn.addEventListener("click", () => {
                modal.showModal();
            });

            const closeModalBtn = document.querySelector("#closeModal");
            closeModalBtn.addEventListener("click", () => {
                modal.close();
            });

            const iconElements = document.querySelectorAll('.fa-trash-can');
            iconElements.forEach(iconElement => {
                iconElement.addEventListener('click', (e) => {
                    e.preventDefault();
                    const container = iconElement.parentNode;
                    const image = container.querySelector("img");
                    console.log(image);
                    const id = image.id; 
                    const jwtToken = localStorage.getItem("jwtToken");
                    fetch(`http://localhost:5678/api/works/${id}`, {
                            method: 'DELETE',
                            headers: {
                            'Authorization': `Bearer ${jwtToken}`
                            }
                        })
                        .then(response => console.log(response))
                        .catch(error => console.log(error));
                });
            });

        });
    </script>

</body>

</html>